<!DOCTYPE html>
<html lang="">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>p5.js example</title>
  <style>
    body {
      padding: 0;
      margin: 0;
      background-color: #1b1b1b;
      color: aliceblue;
    }
  </style>
  <script src="../p5/p5.min.js"></script>
  <script type="module" src="./breath.js"></script>
  <!-- <script src="../addons/p5.sound.js"></script> -->
  <script type="module" src="./julia.js"></script>

</head>

<body>
  <h1>Julia Set</h1>
  <main id="sketch">
  </main>
  <aside>
    <div id="mouseCoordinates"></div>
    <ul>
      <li>pan camera by dragging left mouse</li>
      <li>scale image with mousewheel</li>
      <li>move control point by dragging right mouse</li>
      <li>scale dragging motions using current scale</li>
      <li>implement bounds?</li>
    </ul>
  </aside>
</body>

<script type="module">
  import Breath from "./breath.js";
  import Julia from "./julia.js";

  let coordinates = document.getElementById("mouseCoordinates");

  const s = (p5) => {
    let width = 512;
    let height = 512;
    let emptyColor = p5.color(0,255,0);
    let fullColor = p5.color(0,0,255);
    let breathing = new Breath(2000,2000,2000,2000);
    let julia = new Julia(p5, width, height);
    let zoom = 1; // should this just be just be part of julia...

    p5.setup = function() {
      p5.frameRate(10);
      p5.createCanvas(width, height);
      p5.pixelDensity(1);

      julia.position = [0,0];
      julia.control = [-0.55, -0.55];
      //julia.setScale();

      breathing.play();
    }
    p5.draw = function() {
      // let [r,i] = julia.position;
      // julia.position = [zoom*(r + p5.movedX)/width, zoom*(i + p5.movedY)/width];

      breathing.update(p5.deltaTime);
      julia.update();
      p5.image(julia.image,0,0);
    }
    p5.mouseWheel = function(event) {
      if (event.delta<0)
        zoom *= 0.9;
      else if (event.delta>0)
        zoom *= 1.1;
      julia.scale = zoom / width;
    }
    p5.mouseDragged = function(event){
      // TODO track total drag of left and right buttons
    }
    p5.mouseMoved = function(event) {
      let M = [p5.mouseX, p5.mouseY];
      let I = julia.screenToImage(M);
      let M2 = julia.imageToScreen(I);
      if (M[0]!=M2[0] || M[1]!=M2[1])
        console.error(M,I,M2);
      // console.log(M,I,M2);
      coordinates.innerText = "(r,i) = ["+I[0]+", "+I[1]+"]";
    }
  }
  let sketch = new p5(s, "#sketch")
</script>

</html>